#!/usr/bin/env bash
set -euo pipefail

dir="$(cd "$(dirname "$0")" && pwd)"
app_dir="/tmp/onix-tests/fizzy"

if [ ! -d "$app_dir" ]; then
  echo "SKIP: fizzy not found at $app_dir (private project, clone manually)"
  exit 0
fi

cd "$app_dir"
rm -rf tmp/cache/bootsnap 2>/dev/null || true

exec nix-shell "$dir/devshell.nix" --run "
  RAILS_ENV=test bin/rails db:prepare
  bin/rails test
"
