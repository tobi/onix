# onix examples — Justfile
# Run from examples/ directory

set shell := ["bash", "-euo", "pipefail", "-c"]

onix := "ruby -I../lib ../exe/onix"

# ── Setup ─────────────────────────────────────────────────────────

# Clone test projects and run import + generate
[group('setup')]
setup *args:
    bin/setup {{args}}

# Initialize project structure
[group('setup')]
init:
    {{onix}} init .

# Import a project (path to Gemfile.lock or project dir)
[group('setup')]
import *args:
    {{onix}} import {{args}}

# ── Generate ──────────────────────────────────────────────────────

# Prefetch hashes and generate nix derivations
[group('generate')]
generate *args:
    {{onix}} generate {{args}}

# ── Build ─────────────────────────────────────────────────────────

# Build gems: all, by project, or a single gem
[group('build')]
build *args:
    {{onix}} build {{args}}

# ── Test & Check ──────────────────────────────────────────────────

# Run checks (nix-eval, packageset-complete, secrets)
[group('test')]
check *args:
    {{onix}} check {{args}}

# Run a project's test suite
[group('test')]
test app:
    tests/{{app}}/run-tests

# Run all project tests
[group('test')]
test-all:
    tests/run-all
